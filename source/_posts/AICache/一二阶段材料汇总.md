---
title: 材料汇总
date: 2025-06-29 12:50:19
categories:
  - data storage
tags:
  - 实习项目
---

# 一阶段

在 ocf 中实现二次准入

## 动机

trace 中存在大量只会访问一次的请求，用二次准入过滤掉这些请求，防止其污染缓存空间。

## 技术点

核心代码

```
bool ocf_history_check_second_chance(uint64_t addr, uint64_t size) {
    // 计算页面对齐的地址
    uint64_t start_addr = PAGE_ALIGN_DOWN(addr);
    uint64_t end_addr = PAGE_ALIGN_DOWN(addr + size - 1);
    uint64_t total_pages = PAGES_IN_REQ(start_addr, end_addr);
    uint64_t hit_pages = 0;

    // 检查历史记录中的命中率
    for (uint64_t curr_addr = start_addr; curr_addr <= end_addr; curr_addr += PAGE_SIZE) {
        if (ocf_history_hash_find(curr_addr)) {
            hit_pages++;
        }
    }

    // 如果命中率低于阈值，将页面添加到历史记录并返回 false
    if ((float)hit_pages / total_pages < HISTORY_HIT_RATIO_THRESHOLD) {
        // 将所有页面添加到历史记录
        for (uint64_t curr_addr = start_addr; curr_addr <= end_addr; curr_addr += PAGE_SIZE) {
            ocf_history_hash_add_addr(curr_addr);
        }
        return false;  // 标记为 1（一次性访问）
    }

    return true;  // 标记为 0（应被缓存）
}
```

使用具有 LRU的哈希表来维护访问历史。主要组件包括：

### 主要特点：

- 采用 4K 粒度
- 使用哈希表存储访问历史
- 当历史记录超过容量时，实施 LRU 驱逐策略
- 根据负载因子动态调整大小

## 结果

部分 trace 效果明显（一次访问较多的 trace），能有效提升整体带宽

# 二阶段

OTAE 决策树准入算法

## 动机

一阶段提出的二次准入算法基于启发式规则，难以面对动态变化的工作负载。因此提出决策树准入

## 技术点

OTAE（优化树状准入引擎）是一种智能缓存准入策略，利用决策树预测是否应将缓存块准入到缓存中。通过学习历史访问模式并做出智能准入决策，旨在提高缓存效率。

### 特征提取

离线提取六个重要特征

1. Request address - The starting address of the IO request
2. Request size - The size of the IO request in bytes
3. Access timestamp - The time when the request was made
4. Reuse time - Time since last access (in microseconds)
5. Average requests per minute - Current request rate
6. Access frequency - Number of times this address has been accessed

### 标签生成

利用二次准入算法生成 tag，用于模型学习

### 模型训练

利用生成的特征和标签，使用 python 的 sk-learn 库进行监督学习，生成决策树模型参数文件

### 模型应用

将生成的决策树参数文件提取到 c++ 中，生成对应的决策树类，对每一个请求进行准入判断。

## 结果

通过定期对模型进行训练更新，模型可以针对不同的工作负载进行动态调整。